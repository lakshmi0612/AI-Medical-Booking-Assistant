AI BOOKING ASSISTANT - SYSTEM ARCHITECTURE
===========================================

┌─────────────────────────────────────────────────────────────────────┐
│                          USER INTERFACE                             │
│                         (Streamlit App)                             │
│  ┌──────────────────┐  ┌──────────────────┐  ┌─────────────────┐  │
│  │  Chat Interface  │  │  PDF Uploader    │  │ Admin Dashboard │  │
│  │  - Messages      │  │  - File Widget   │  │ - Bookings      │  │
│  │  - Input Box     │  │  - Process Btn   │  │ - Search        │  │
│  │  - Clear Button  │  │  - Status Msg    │  │ - Export CSV    │  │
│  └──────────────────┘  └──────────────────┘  └─────────────────┘  │
└─────────────────────────────┬───────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────────┐
│                       CHAT LOGIC LAYER                              │
│                     (app/chat_logic.py)                             │
│  ┌──────────────────────────────────────────────────────────────┐  │
│  │  Intent Detection Engine                                      │  │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌────────────┐   │  │
│  │  │ Booking  │  │ Question │  │ General  │  │Confirmation│   │  │
│  │  │  Intent  │  │  Intent  │  │  Intent  │  │   Intent   │   │  │
│  │  └─────┬────┘  └────┬─────┘  └────┬─────┘  └──────┬─────┘   │  │
│  └────────┼────────────┼─────────────┼────────────────┼─────────┘  │
└───────────┼────────────┼─────────────┼────────────────┼─────────────┘
            │            │             │                │
            ▼            ▼             ▼                ▼
┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐
│  BOOKING    │  │  RAG        │  │  GENERAL    │  │   TOOLS     │
│  FLOW       │  │  PIPELINE   │  │  CHAT       │  │   SYSTEM    │
│             │  │             │  │             │  │             │
│ booking_    │  │ rag_        │  │ LLM         │  │ tools.py    │
│ flow.py     │  │ pipeline.py │  │ Response    │  │             │
└──────┬──────┘  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘
       │                │                │                │
       │                │                │                │
       ▼                ▼                ▼                ▼
┌──────────────────────────────────────────────────────────────────┐
│                    DATA & SERVICES LAYER                         │
│                                                                  │
│  ┌────────────────┐  ┌────────────────┐  ┌────────────────┐    │
│  │  VECTOR STORE  │  │   GROQ API     │  │   DATABASE     │    │
│  │     (FAISS)    │  │                │  │   (Supabase)   │    │
│  │                │  │  Mixtral-8x7b  │  │                │    │
│  │  - Embeddings  │  │  - Chat        │  │  - customers   │    │
│  │  - Similarity  │  │  - Completion  │  │  - bookings    │    │
│  │  - Retrieval   │  │  - 32k Context │  │  - RLS         │    │
│  └────────────────┘  └────────────────┘  └────────────────┘    │
│                                                                  │
│  ┌────────────────┐  ┌────────────────┐                         │
│  │  EMAIL SERVICE │  │  MEMORY STORE  │                         │
│  │  (Gmail SMTP)  │  │  (Session)     │                         │
│  │                │  │                │                         │
│  │  - HTML Email  │  │  - Messages    │                         │
│  │  - Templating  │  │  - State       │                         │
│  │  - Error Handle│  │  - 25 History  │                         │
│  └────────────────┘  └────────────────┘                         │
└──────────────────────────────────────────────────────────────────┘


DATA FLOW DIAGRAMS
==================

1. RAG FLOW
───────────

   User → "What are your services?"
     │
     ▼
   ┌─────────────────┐
   │  Chat Interface │
   └────────┬────────┘
            │
            ▼
   ┌─────────────────┐
   │ Intent Detection│ → "question"
   └────────┬────────┘
            │
            ▼
   ┌─────────────────┐
   │  RAG Pipeline   │
   │                 │
   │  1. Query Embed │
   │  2. Search Vec  │
   │  3. Get Chunks  │
   │  4. LLM + Ctx   │
   └────────┬────────┘
            │
            ▼
   ┌─────────────────┐
   │  Response:      │
   │  "We offer:     │
   │  - General      │
   │  - Pediatrics   │
   │  ..."           │
   └─────────────────┘


2. BOOKING FLOW
───────────────

   User → "I want to book"
     │
     ▼
   ┌─────────────────┐
   │ Intent Detector │ → "booking"
   └────────┬────────┘
            │
            ▼
   ┌─────────────────┐
   │  Extract Info   │
   │  - Name         │
   │  - Email        │
   │  - Phone        │
   │  - Type         │
   │  - Date         │
   │  - Time         │
   └────────┬────────┘
            │
            ▼
   ┌─────────────────┐
   │  Validate Data  │
   │  - Email format │
   │  - Date valid?  │
   │  - Time valid?  │
   └────────┬────────┘
            │
            ▼
   ┌─────────────────┐
   │ Show Summary    │
   │ Ask Confirm     │
   └────────┬────────┘
            │
    User says "yes"
            │
            ▼
   ┌─────────────────┐
   │  Save to DB     │ → Booking ID
   └────────┬────────┘
            │
            ▼
   ┌─────────────────┐
   │  Send Email     │
   └────────┬────────┘
            │
            ▼
   ┌─────────────────┐
   │  Confirm to     │
   │  User           │
   └─────────────────┘


3. PDF PROCESSING FLOW
──────────────────────

   User uploads PDF
     │
     ▼
   ┌─────────────────┐
   │  File Upload    │
   └────────┬────────┘
            │
            ▼
   ┌─────────────────┐
   │ Extract Text    │
   │  (PyPDF)        │
   └────────┬────────┘
            │
            ▼
   ┌─────────────────┐
   │  Chunk Text     │
   │  (1000 chars)   │
   └────────┬────────┘
            │
            ▼
   ┌─────────────────┐
   │  Generate       │
   │  Embeddings     │
   │  (HuggingFace)  │
   └────────┬────────┘
            │
            ▼
   ┌─────────────────┐
   │  Store in       │
   │  FAISS          │
   └────────┬────────┘
            │
            ▼
   ┌─────────────────┐
   │  Ready for      │
   │  Queries        │
   └─────────────────┘


COMPONENT INTERACTIONS
======================

┌──────────────────────────────────────────────────────────┐
│                      User Action                         │
└─────────────────────┬────────────────────────────────────┘
                      │
                      ▼
              ┌───────────────┐
              │ Streamlit UI  │
              └───────┬───────┘
                      │
                      ▼
              ┌───────────────┐
              │ Chat Logic    │
              └───┬───────┬───┘
                  │       │
         ┌────────┘       └────────┐
         ▼                         ▼
  ┌──────────┐            ┌──────────────┐
  │ Booking  │            │  RAG Query   │
  │  Flow    │            │              │
  └────┬─────┘            └──────┬───────┘
       │                         │
       │  ┌──────────────────────┘
       │  │
       ▼  ▼
  ┌──────────────┐
  │    Tools     │
  │              │
  │ - rag_query  │
  │ - save_book  │
  │ - send_email │
  └──────┬───────┘
         │
         │
    ┌────┴────┬────────┐
    ▼         ▼        ▼
┌────────┐ ┌────┐ ┌────────┐
│Supabase│ │Groq│ │  SMTP  │
└────────┘ └────┘ └────────┘


TECHNOLOGY STACK
================

┌─────────────────────────────────────────────────┐
│              PRESENTATION LAYER                 │
│                                                 │
│  Streamlit 1.31.0                              │
│  - UI Framework                                 │
│  - Session State                                │
│  - Chat Components                              │
└─────────────────────────────────────────────────┘
                      ▲
                      │
┌─────────────────────┴───────────────────────────┐
│              APPLICATION LAYER                  │
│                                                 │
│  Python 3.10+                                  │
│  - Business Logic                               │
│  - Intent Detection                             │
│  - Data Validation                              │
└─────────────────────────────────────────────────┘
                      ▲
                      │
┌─────────────────────┴───────────────────────────┐
│                 AI/ML LAYER                     │
│                                                 │
│  LangChain 0.1.10                              │
│  HuggingFace Embeddings                        │
│  FAISS 1.7.4                                   │
└─────────────────────────────────────────────────┘
                      ▲
                      │
┌─────────────────────┴───────────────────────────┐
│                SERVICE LAYER                    │
│                                                 │
│  Groq API (LLM)                                │
│  Supabase (Database)                           │
│  Gmail SMTP (Email)                            │
└─────────────────────────────────────────────────┘


DEPLOYMENT ARCHITECTURE
=======================

┌───────────────────────────────────────────────────┐
│              Streamlit Cloud                      │
│                                                   │
│  ┌─────────────────────────────────────────┐     │
│  │  Application Container                  │     │
│  │                                          │     │
│  │  - Streamlit App                         │     │
│  │  - Python Runtime                        │     │
│  │  - Dependencies                          │     │
│  │  - Environment Secrets                   │     │
│  └─────────────────────────────────────────┘     │
│                                                   │
└───────────────┬───────────────────────────────────┘
                │
                │ HTTPS
                │
                ▼
┌───────────────────────────────────────────────────┐
│           External Services (Free Tier)           │
│                                                   │
│  ┌────────────┐  ┌────────────┐  ┌───────────┐  │
│  │  Groq API  │  │  Supabase  │  │   Gmail   │  │
│  │            │  │            │  │   SMTP    │  │
│  │  - LLM     │  │  - PostgreSQL│ │  - Email  │  │
│  │  - Chat    │  │  - REST API│  │  - SMTP   │  │
│  └────────────┘  └────────────┘  └───────────┘  │
└───────────────────────────────────────────────────┘


SECURITY ARCHITECTURE
=====================

┌─────────────────────────────────────────────┐
│           User Interface                    │
│           (Public Access)                   │
└──────────────────┬──────────────────────────┘
                   │
                   │ HTTPS
                   │
                   ▼
┌─────────────────────────────────────────────┐
│        Application Layer                    │
│                                             │
│  ┌─────────────────────────────────────┐   │
│  │  Input Validation                   │   │
│  │  - Email format                     │   │
│  │  - Date/Time checks                 │   │
│  │  - SQL injection prevention         │   │
│  └─────────────────────────────────────┘   │
└──────────────────┬──────────────────────────┘
                   │
                   │ Encrypted
                   │
                   ▼
┌─────────────────────────────────────────────┐
│          Secrets Management                 │
│                                             │
│  - API Keys (secrets.toml)                 │
│  - Database Credentials                     │
│  - Email Passwords                          │
│  - Not in Git (.gitignore)                 │
└──────────────────┬──────────────────────────┘
                   │
                   │ TLS/SSL
                   │
                   ▼
┌─────────────────────────────────────────────┐
│          External Services                  │
│                                             │
│  - RLS (Row Level Security) ✓              │
│  - Encrypted at Rest ✓                     │
│  - HTTPS Only ✓                            │
└─────────────────────────────────────────────┘